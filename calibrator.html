<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Map Calibrator - Geography Puzzle</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a2e;
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
            color: #4ecdc4;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .map-section {
            flex: 1;
            min-width: 600px;
        }

        .controls-section {
            width: 350px;
            background: #16213e;
            border-radius: 10px;
            padding: 20px;
        }

        .map-container {
            position: relative;
            background: #0f3460;
            border-radius: 10px;
            overflow: hidden;
            cursor: crosshair;
        }

        #mapImage {
            width: 100%;
            display: block;
        }

        #overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .marker {
            position: absolute;
            width: 10px;
            height: 10px;
            background: red;
            border: 2px solid white;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
        }

        .marker.point {
            width: 20px;
            height: 20px;
            background: #ff6b6b;
            box-shadow: 0 0 10px #ff6b6b;
        }

        .rect-highlight {
            position: absolute;
            border: 3px solid #4ecdc4;
            background: rgba(78, 205, 196, 0.3);
            pointer-events: none;
        }

        .coords-display {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(0,0,0,0.8);
            padding: 10px 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 14px;
            direction: ltr;
        }

        .mode-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .mode-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background: #0f3460;
            color: #fff;
            font-size: 14px;
            transition: all 0.2s;
        }

        .mode-btn.active {
            background: #4ecdc4;
            color: #1a1a2e;
        }

        .mode-btn:hover {
            opacity: 0.8;
        }

        .output-section {
            margin-top: 20px;
        }

        .output-section h3 {
            margin-bottom: 10px;
            color: #4ecdc4;
        }

        #output {
            width: 100%;
            height: 200px;
            background: #0a0a14;
            border: 1px solid #333;
            border-radius: 5px;
            color: #4ecdc4;
            padding: 10px;
            font-family: monospace;
            font-size: 12px;
            resize: vertical;
            direction: ltr;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #4ecdc4;
            color: #1a1a2e;
        }

        .btn-secondary {
            background: #e94560;
            color: #fff;
        }

        .btn:hover {
            opacity: 0.8;
        }

        .item-list {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 10px;
        }

        .item {
            background: #0f3460;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .item:hover {
            background: #1a4a7a;
        }

        .item.selected {
            border: 2px solid #4ecdc4;
        }

        .item-name {
            font-weight: bold;
        }

        .item-coords {
            font-size: 11px;
            color: #888;
            font-family: monospace;
            direction: ltr;
            margin-top: 5px;
        }

        .instructions {
            background: #0f3460;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            font-size: 13px;
            line-height: 1.6;
        }

        .instructions h4 {
            color: #4ecdc4;
            margin-bottom: 10px;
        }

        .input-group {
            margin: 10px 0;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            color: #888;
        }

        .input-group input {
            width: 100%;
            padding: 8px;
            border: 1px solid #333;
            border-radius: 5px;
            background: #0a0a14;
            color: #fff;
            font-size: 14px;
        }

        .tab-buttons {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
        }

        .tab-btn {
            flex: 1;
            padding: 8px;
            border: none;
            border-radius: 5px 5px 0 0;
            cursor: pointer;
            background: #0f3460;
            color: #888;
            font-size: 12px;
        }

        .tab-btn.active {
            background: #16213e;
            color: #4ecdc4;
            border-bottom: 2px solid #4ecdc4;
        }
    </style>
</head>
<body>
    <h1>Map Calibrator Tool</h1>

    <div class="container">
        <div class="map-section">
            <div class="map-container" id="mapContainer">
                <img id="mapImage" src="world_map.png" alt="World Map">
                <div id="overlay"></div>
                <div class="coords-display" id="coordsDisplay">
                    X: 0.000 | Y: 0.000
                </div>
            </div>
        </div>

        <div class="controls-section">
            <div class="instructions">
                <h4>How to Use</h4>
                <p><strong>Point Mode:</strong> Click to mark a city location</p>
                <p><strong>Rectangle Mode:</strong> Click and drag to mark continent/country bounds</p>
                <p>Coordinates are normalized 0-1 (0=left/top, 1=right/bottom)</p>
            </div>

            <div class="mode-selector">
                <button class="mode-btn active" data-mode="point" onclick="setMode('point')">Point (Cities)</button>
                <button class="mode-btn" data-mode="rect" onclick="setMode('rect')">Rectangle (Areas)</button>
            </div>

            <div class="input-group">
                <label>Item Name (Hebrew)</label>
                <input type="text" id="itemName" placeholder="e.g. ניו יורק">
            </div>

            <div class="tab-buttons">
                <button class="tab-btn active" onclick="showTab('continents')">Continents</button>
                <button class="tab-btn" onclick="showTab('countries')">Countries</button>
                <button class="tab-btn" onclick="showTab('cities')">Cities</button>
            </div>

            <div class="item-list" id="itemList">
                <!-- Items will be populated here -->
            </div>

            <div class="output-section">
                <h3>Generated Code</h3>
                <textarea id="output" readonly></textarea>
                <button class="btn btn-primary" onclick="copyOutput()">Copy</button>
                <button class="btn btn-secondary" onclick="clearAll()">Clear All</button>
                <button class="btn btn-primary" onclick="exportAll()">Export All</button>
            </div>
        </div>
    </div>

    <script>
        // Current mode and state
        let mode = 'point';
        let isDrawing = false;
        let startX = 0, startY = 0;
        let currentTab = 'continents';

        // Stored calibrations
        const calibrations = {
            continents: [],
            countries: [],
            cities: []
        };

        // Current GeoData from game.js for reference
        const existingData = {
            continents: [
                { name: 'צפון אמריקה', nameEn: 'North America', bounds: { x: 0.04, y: 0.06, width: 0.21, height: 0.46 } },
                { name: 'דרום אמריקה', nameEn: 'South America', bounds: { x: 0.17, y: 0.52, width: 0.13, height: 0.40 } },
                { name: 'אירופה', nameEn: 'Europe', bounds: { x: 0.38, y: 0.06, width: 0.14, height: 0.24 } },
                { name: 'אפריקה', nameEn: 'Africa', bounds: { x: 0.38, y: 0.28, width: 0.20, height: 0.50 } },
                { name: 'אסיה', nameEn: 'Asia', bounds: { x: 0.50, y: 0.04, width: 0.42, height: 0.54 } },
                { name: 'אוסטרליה', nameEn: 'Australia', bounds: { x: 0.78, y: 0.60, width: 0.14, height: 0.22 } },
                { name: 'אנטארקטיקה', nameEn: 'Antarctica', bounds: { x: 0.10, y: 0.92, width: 0.80, height: 0.06 } }
            ],
            countries: [
                { name: 'ברזיל', continent: 'דרום אמריקה', bounds: { x: 0.20, y: 0.54, width: 0.09, height: 0.20 } },
                { name: 'מצרים', continent: 'אפריקה', bounds: { x: 0.48, y: 0.30, width: 0.06, height: 0.10 } },
                { name: 'הודו', continent: 'אסיה', bounds: { x: 0.64, y: 0.32, width: 0.08, height: 0.16 } },
                { name: 'סין', continent: 'אסיה', bounds: { x: 0.70, y: 0.18, width: 0.14, height: 0.20 } },
                { name: 'ארה"ב', continent: 'צפון אמריקה', bounds: { x: 0.05, y: 0.20, width: 0.17, height: 0.18 } },
                { name: 'רוסיה', continent: 'אסיה', bounds: { x: 0.50, y: 0.04, width: 0.40, height: 0.18 } },
                { name: 'אוסטרליה', continent: 'אוסטרליה', bounds: { x: 0.78, y: 0.60, width: 0.14, height: 0.22 } },
                { name: 'קנדה', continent: 'צפון אמריקה', bounds: { x: 0.05, y: 0.06, width: 0.20, height: 0.16 } },
                { name: 'ארגנטינה', continent: 'דרום אמריקה', bounds: { x: 0.18, y: 0.72, width: 0.06, height: 0.18 } },
                { name: 'יפן', continent: 'אסיה', bounds: { x: 0.86, y: 0.24, width: 0.05, height: 0.12 } }
            ],
            cities: [
                { name: 'ניו יורק', country: 'ארה"ב', position: { x: 0.21, y: 0.28 } },
                { name: 'לונדון', country: 'בריטניה', position: { x: 0.42, y: 0.16 } },
                { name: 'טוקיו', country: 'יפן', position: { x: 0.88, y: 0.28 } },
                { name: 'פריז', country: 'צרפת', position: { x: 0.43, y: 0.19 } },
                { name: 'סידני', country: 'אוסטרליה', position: { x: 0.89, y: 0.74 } },
                { name: 'קהיר', country: 'מצרים', position: { x: 0.50, y: 0.32 } },
                { name: 'מומביי', country: 'הודו', position: { x: 0.66, y: 0.38 } },
                { name: 'ריו דה ז\'נרו', country: 'ברזיל', position: { x: 0.27, y: 0.68 } },
                { name: 'מוסקבה', country: 'רוסיה', position: { x: 0.54, y: 0.14 } },
                { name: 'בייג\'ינג', country: 'סין', position: { x: 0.80, y: 0.26 } }
            ]
        };

        const mapContainer = document.getElementById('mapContainer');
        const mapImage = document.getElementById('mapImage');
        const overlay = document.getElementById('overlay');
        const coordsDisplay = document.getElementById('coordsDisplay');
        const output = document.getElementById('output');

        // Get normalized coordinates from mouse position
        function getNormalizedCoords(e) {
            const rect = mapImage.getBoundingClientRect();
            const x = (e.clientX - rect.left) / rect.width;
            const y = (e.clientY - rect.top) / rect.height;
            return { x: Math.max(0, Math.min(1, x)), y: Math.max(0, Math.min(1, y)) };
        }

        // Mouse move - show coordinates
        mapContainer.addEventListener('mousemove', (e) => {
            const coords = getNormalizedCoords(e);
            coordsDisplay.textContent = `X: ${coords.x.toFixed(3)} | Y: ${coords.y.toFixed(3)}`;

            if (isDrawing && mode === 'rect') {
                updateRectPreview(e);
            }
        });

        // Mouse down
        mapContainer.addEventListener('mousedown', (e) => {
            const coords = getNormalizedCoords(e);

            if (mode === 'point') {
                addPointMarker(coords);
            } else {
                startX = coords.x;
                startY = coords.y;
                isDrawing = true;
            }
        });

        // Mouse up
        mapContainer.addEventListener('mouseup', (e) => {
            if (isDrawing && mode === 'rect') {
                const coords = getNormalizedCoords(e);
                finishRect(coords);
            }
            isDrawing = false;
        });

        // Add point marker
        function addPointMarker(coords) {
            const name = document.getElementById('itemName').value || 'Unnamed';

            const marker = document.createElement('div');
            marker.className = 'marker point';
            marker.style.left = (coords.x * 100) + '%';
            marker.style.top = (coords.y * 100) + '%';
            overlay.appendChild(marker);

            const item = {
                name: name,
                position: { x: coords.x, y: coords.y }
            };

            calibrations[currentTab].push(item);
            updateItemList();
            updateOutput();
        }

        // Rectangle preview
        let rectPreview = null;
        function updateRectPreview(e) {
            const coords = getNormalizedCoords(e);

            if (!rectPreview) {
                rectPreview = document.createElement('div');
                rectPreview.className = 'rect-highlight';
                overlay.appendChild(rectPreview);
            }

            const left = Math.min(startX, coords.x);
            const top = Math.min(startY, coords.y);
            const width = Math.abs(coords.x - startX);
            const height = Math.abs(coords.y - startY);

            rectPreview.style.left = (left * 100) + '%';
            rectPreview.style.top = (top * 100) + '%';
            rectPreview.style.width = (width * 100) + '%';
            rectPreview.style.height = (height * 100) + '%';
        }

        // Finish rectangle
        function finishRect(endCoords) {
            const name = document.getElementById('itemName').value || 'Unnamed';

            const left = Math.min(startX, endCoords.x);
            const top = Math.min(startY, endCoords.y);
            const width = Math.abs(endCoords.x - startX);
            const height = Math.abs(endCoords.y - startY);

            if (width < 0.01 || height < 0.01) {
                // Too small, ignore
                if (rectPreview) {
                    rectPreview.remove();
                    rectPreview = null;
                }
                return;
            }

            const item = {
                name: name,
                bounds: { x: left, y: top, width: width, height: height }
            };

            calibrations[currentTab].push(item);

            // Keep the rectangle
            rectPreview = null;

            updateItemList();
            updateOutput();
        }

        // Set mode
        function setMode(newMode) {
            mode = newMode;
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.mode === newMode);
            });
        }

        // Show tab
        function showTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.toggle('active', btn.textContent.toLowerCase().includes(tab));
            });
            updateItemList();
            renderOverlay();
        }

        // Update item list
        function updateItemList() {
            const list = document.getElementById('itemList');
            list.innerHTML = '';

            // Show existing data first
            const existing = existingData[currentTab] || [];
            existing.forEach((item, idx) => {
                const div = document.createElement('div');
                div.className = 'item';
                div.innerHTML = `
                    <div class="item-name">${item.name} (existing)</div>
                    <div class="item-coords">${formatItemCoords(item)}</div>
                `;
                div.onclick = () => highlightItem(item);
                list.appendChild(div);
            });

            // Show calibrated items
            calibrations[currentTab].forEach((item, idx) => {
                const div = document.createElement('div');
                div.className = 'item selected';
                div.innerHTML = `
                    <div class="item-name">${item.name} (NEW)</div>
                    <div class="item-coords">${formatItemCoords(item)}</div>
                `;
                div.onclick = () => highlightItem(item);
                list.appendChild(div);
            });
        }

        // Format item coordinates for display
        function formatItemCoords(item) {
            if (item.position) {
                return `position: { x: ${item.position.x.toFixed(3)}, y: ${item.position.y.toFixed(3)} }`;
            } else if (item.bounds) {
                return `bounds: { x: ${item.bounds.x.toFixed(3)}, y: ${item.bounds.y.toFixed(3)}, w: ${item.bounds.width.toFixed(3)}, h: ${item.bounds.height.toFixed(3)} }`;
            }
            return '';
        }

        // Highlight item on map
        function highlightItem(item) {
            const highlight = document.createElement('div');

            if (item.position) {
                highlight.className = 'marker point';
                highlight.style.left = (item.position.x * 100) + '%';
                highlight.style.top = (item.position.y * 100) + '%';
                highlight.style.background = '#ffff00';
            } else if (item.bounds) {
                highlight.className = 'rect-highlight';
                highlight.style.left = (item.bounds.x * 100) + '%';
                highlight.style.top = (item.bounds.y * 100) + '%';
                highlight.style.width = (item.bounds.width * 100) + '%';
                highlight.style.height = (item.bounds.height * 100) + '%';
                highlight.style.borderColor = '#ffff00';
                highlight.style.background = 'rgba(255, 255, 0, 0.3)';
            }

            overlay.appendChild(highlight);

            setTimeout(() => highlight.remove(), 2000);
        }

        // Render all markers/rects for current tab
        function renderOverlay() {
            overlay.innerHTML = '';

            calibrations[currentTab].forEach(item => {
                if (item.position) {
                    const marker = document.createElement('div');
                    marker.className = 'marker point';
                    marker.style.left = (item.position.x * 100) + '%';
                    marker.style.top = (item.position.y * 100) + '%';
                    overlay.appendChild(marker);
                } else if (item.bounds) {
                    const rect = document.createElement('div');
                    rect.className = 'rect-highlight';
                    rect.style.left = (item.bounds.x * 100) + '%';
                    rect.style.top = (item.bounds.y * 100) + '%';
                    rect.style.width = (item.bounds.width * 100) + '%';
                    rect.style.height = (item.bounds.height * 100) + '%';
                    overlay.appendChild(rect);
                }
            });
        }

        // Update output
        function updateOutput() {
            let code = '';

            if (calibrations.continents.length > 0) {
                code += 'continents: [\n';
                calibrations.continents.forEach(item => {
                    code += `    { name: '${item.name}', nameEn: '', bounds: { x: ${item.bounds.x.toFixed(3)}, y: ${item.bounds.y.toFixed(3)}, width: ${item.bounds.width.toFixed(3)}, height: ${item.bounds.height.toFixed(3)} } },\n`;
                });
                code += '],\n\n';
            }

            if (calibrations.countries.length > 0) {
                code += 'countries: [\n';
                calibrations.countries.forEach(item => {
                    code += `    { name: '${item.name}', continent: '', bounds: { x: ${item.bounds.x.toFixed(3)}, y: ${item.bounds.y.toFixed(3)}, width: ${item.bounds.width.toFixed(3)}, height: ${item.bounds.height.toFixed(3)} } },\n`;
                });
                code += '],\n\n';
            }

            if (calibrations.cities.length > 0) {
                code += 'cities: [\n';
                calibrations.cities.forEach(item => {
                    code += `    { name: '${item.name}', country: '', position: { x: ${item.position.x.toFixed(3)}, y: ${item.position.y.toFixed(3)} } },\n`;
                });
                code += ']\n';
            }

            output.value = code;
        }

        // Copy output
        function copyOutput() {
            output.select();
            document.execCommand('copy');
            alert('Copied to clipboard!');
        }

        // Clear all
        function clearAll() {
            if (confirm('Clear all calibrations?')) {
                calibrations.continents = [];
                calibrations.countries = [];
                calibrations.cities = [];
                overlay.innerHTML = '';
                updateItemList();
                updateOutput();
            }
        }

        // Export all as JSON
        function exportAll() {
            const data = JSON.stringify(calibrations, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'map-calibrations.json';
            a.click();
        }

        // Initialize
        updateItemList();
    </script>
</body>
</html>
